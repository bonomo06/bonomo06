name: Generate Pacman
on:
  schedule:
    - cron: "0 */24 * * *"
  workflow_dispatch:

jobs:
  build:
    name: Generate Pacman Graph
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Generate Pacman contribution graph
        uses: abozanona/pacman-contribution-graph@main
        with:
          github_user_name: bonomo06
          github_token: ${{ secrets.GITHUB_TOKEN }}
      
      # Debug completo - procura em todos os diretórios
      - name: Debug - Find all files
        run: |
          echo "=== Complete directory tree ==="
          find . -type f -name "*.svg" || echo "No SVG files found"
          echo ""
          echo "=== Root directory ==="
          ls -la
          echo ""
          echo "=== Dist directory ==="
          ls -la dist/ 2>/dev/null || echo "No dist directory"
          echo ""
          echo "=== All directories ==="
          find . -type d -maxdepth 2
      
      - name: Prepare and move files
        run: |
          mkdir -p output
          
          # Procura SVGs em vários locais possíveis
          FOUND=0
          
          # Tentativa 1: root directory
          if ls pacman-*.svg 1> /dev/null 2>&1; then
            echo "Found SVG files in root"
            mv pacman-*.svg output/
            FOUND=1
          fi
          
          # Tentativa 2: dist directory
          if [ -d "dist" ] && ls dist/*.svg 1> /dev/null 2>&1; then
            echo "Found SVG files in dist/"
            mv dist/*.svg output/
            FOUND=1
          fi
          
          # Tentativa 3: qualquer SVG no root
          if [ "$FOUND" -eq 0 ] && ls *.svg 1> /dev/null 2>&1; then
            echo "Found generic SVG files in root"
            mv *.svg output/
            FOUND=1
          fi
          
          # Tentativa 4: procura recursiva
          if [ "$FOUND" -eq 0 ]; then
            SVG_FILES=$(find . -name "*.svg" -type f | grep -v ".git" | grep -v "node_modules")
            if [ ! -z "$SVG_FILES" ]; then
              echo "Found SVG files recursively:"
              echo "$SVG_FILES"
              echo "$SVG_FILES" | while read file; do
                cp "$file" output/
              done
              FOUND=1
            fi
          fi
          
          if [ "$FOUND" -eq 0 ]; then
            echo "ERROR: No SVG files found anywhere"
            echo "Listing all files:"
            find . -type f | grep -v ".git"
            exit 1
          fi
          
          echo "=== Files in output directory ==="
          ls -la output/
      
      - name: Deploy to output branch
        uses: crazy-max/ghaction-github-pages@v3.1.0
        with:
          target_branch: output
          build_dir: output
          keep_history: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
